{   LLM 앱이 돌아가는 개략적인 형태도
    LLM 앱을 개발하려면 모델 말고도 다양한 요소가 필요하다
    그건 296p의 그림에 있더라

    LLM이 헛소리하면 환각, 그런데 답변할 때 필요한 정보를 줘서 프롬프트에 함께 전달하는게
    검색 증강 생성인데, 이걸로 환각을 줄일 수 있다.

    검색하고 싶은 데이터를 데이터 소스에서 가져와
    임베딩 모델로 임베딩 벡터로 만들고
    벡터 DB에 저장

    요청과 관련된 데이터를 벡터 DB에서 검색하고
    결과를 받아 다시 프롬프트 모듈에 넣어
    사용자의 프롬프트에 반영

    297p
    이전에 동일하거나 유사한 요청이 있으면 LLM 캐시에서 그 결과를 찾아보고
    있으면 활용 가능하다.

    LLM의 생성결과에 부적절한 문제가 있는지 검증하는 과정이 있음

    서비스에 들어온 사용자의 요청과 응답을 기록함.
    모니터링 과정이 존재
}

298p
{   RAG
    {   RAG가 필요한 이유
        1. LLM은 최신 정보 / 조직의 데이터를 제대로 활용할 수 있도록 모델을 학습시키는데 상당한 시간과 비용 들어감
        2. 근거나 출처가 불명확하고 부정확한 정보를 지어내는 환각이 존재
    }

    RAG: 검색으로 답변에 필요한 정보와 맥락을 제공하고 답변하도록 하는 방법
    LLM Orchestration: 사용자 UI, 임베딩 모델, 벡터 DB 등 LLM 앱을 위한 구성요소를 연결하는 프레임워크

    LLM orchestration framework는 llama index, langchagin, canopy 등이 있다
    실습에서는 라마인덱스를 중심으로 설명과 실습을 진행한다고 한다.

    검색을 저장하는 과정 / 저장한 문서를 검색 / 프롬프트에 검색 결과를 반영하는 과정으로 나뉘어 서술한다고 함

    {   데이터 저장 & 사용
        구성요소
        데이터 소스, 임베딩 모델, 벡터 DB로 구성됨
        ※ 텍스트, 이미지, 음성 모두 데이터 소스이며 처리 방법도 동일
        ※※ 실습은 데이터로

        구축
        데이터 소스를 임베딩 모델을 사용해 임베딩 벡터로 변환
        이를 벡터 DB에 저장
        ※ 검색은 벡터 사이의 거리를 기준으로 함

        모델 종류
        임베딩 모델을 상업용으로 openai의 text-embedding-ada-002가 / 오픈소스는 sentence-transformers
        벡터 DB는 임베딩 벡터를 저장하고, 입력한 벡터와 유사한 벡터를 찾아준다.
        크로마, 밀버스가 오픈소스 파인콘, 위비에이트 등등이 상업 서비스
        요즘은 PostgreSQL 같은 DB에서도 도입했다고 함

        검색
        쿼리를 임베딩 모델을 써서 임베딩, 이를 유클리디안 거리나 코사인 유사도를 사용해서 거리를 계산, 가까운 결과를 반환
        (GPT 피셜) 원문과 해당하는 벡터를 쌍으로 가지고 있음 / 원문은 일정 크기의 청크로 나눠서 가지고 있고, 메타데이터도 있음
        그래서 반환할 때 검색 결과의 벡터에 해당하는 원문을 반환하는것
    }

    {   프롬프트에 검색 결과 통합
        반환된 결과는 프롬프트 모듈에서 사용자의 요청과 하나로 통합됨
        {   환각 현상과 추가 정보, 그리고 RAG의 필요성
            특정 도메인에 대한 지식이 없다고 가정할 때, 정보를 주지않으면 언제든지 환각 현상을 보여 줄 수가 있음,
            이 때 관련된 추가 정보를 프롬프트에 넣었을 때 잘 동작함을 책에서 보여주었다
            그러나 그 때 그 때 필요한 정보를 수동으로 프롬프트에 넣을 수가 없다는 문제가 있다

            예시는 '북태평향 기단과 오호츠크해 기단이 만나 국내에 머무르는 기간'이라는 과학 상식인데,
            관련된 문서를 벡터 DB에 임베딩으로 넣어두면, 프롬프트를 임베딩으로 넣었을 때 검색으로 나오기 때문에,
            관련한 문서를 가져와서 프롬프트에 넣을 수가 있게되며, 이것이 RAG이다
        }

    }
}